---
description: 
globs: 
alwaysApply: true
---
# ğŸ“ ARCHITECTURE STANDARDISÃ‰E â€” NEXT.JS 14 (FULL FRONTEND API)

### ğŸ¯ Objectif

CrÃ©er une architecture **claire, maintenable, modulaire et Ã©volutive**, totalement compatible avec **les Server Components** de Next.js 14, et conforme Ã  des **bonnes pratiques strictes de dÃ©couplage et de responsabilitÃ© unique**.

---

## ğŸ”° RÃˆGLES FONDAMENTALES

1. **Les appels API se font uniquement :**

   * Dans les fichiers `services/*.ts` ou directement dans les **Server Components** (`containers/`, `page.tsx`)
   * **Interdiction absolue** de faire des appels API dans les composants React (`components/`)

2. **Tout composant a un parent "root" (container)** :

   * `containers/` = Composant racine (charge les donnÃ©es, transforme les donnÃ©es, appelle les services)
   * `components/` = Composant UI pur, reÃ§oit ses props depuis son parent, **aucune logique mÃ©tier**

3. **Tous les fichiers partagÃ©s ou rÃ©utilisables sont regroupÃ©s dans `shared/`**

4. **Chaque domaine fonctionnel (auth, blog, dashboard, etc.) est un module indÃ©pendant** situÃ© dans `modules/`, avec sa propre organisation interne.

5. **Aucun mÃ©lange entre les fichiers dâ€™un module et ceux dâ€™un autre.**

---

## ğŸ§­ STRUCTURE GLOBALE DE `src/`

```
src/
â”‚
â”œâ”€â”€ app/                # App Router (pages, layouts)
â”‚
â”œâ”€â”€ modules/            # Modules mÃ©tier, sÃ©parÃ©s et isolÃ©s
â”‚
â”œâ”€â”€ shared/             # Code partagÃ© entre modules (UI, helpers, etc.)
â”‚
â”œâ”€â”€ lib/                # Fonctions bas niveau et accÃ¨s systÃ¨me (cookies, session, cache)
```

---

## ğŸ“ `app/` â€” ROUTING NEXT.JS

> Dossier obligatoire dans App Router. GÃ¨re le routage, le layout, lâ€™arborescence des pages.

### Contenu autorisÃ© :

* `page.tsx` : fichier route
* `layout.tsx` : layout global ou local
* `template.tsx` : si rendu dynamique
* Peut contenir directement des `containers/` pour charger les donnÃ©es
* Peut appeler des `services/` (ex. `getUser()`)

### Exemple :

```bash
app/
â””â”€â”€ (auth)/
    â””â”€â”€ login/
        â””â”€â”€ page.tsx          # Appelle <LoginContainer /> du module auth
```

---

## ğŸ“ `modules/` â€” MODULES MÃ‰TIERS

> Chaque fonctionnalitÃ©/domaine mÃ©tier a son propre dossier. Aucun fichier dâ€™un module ne doit Ãªtre utilisÃ© dans un autre module (sauf via `shared/`).

### Structure interne de chaque module :

```
modules/
â””â”€â”€ [nom-du-module]/
    â”œâ”€â”€ components/       # Composants UI visuels, reÃ§oivent uniquement des props
    â”œâ”€â”€ containers/       # Composants Server Components (chargent les donnÃ©es)
    â”œâ”€â”€ services/         # Fonctions dâ€™appel API / base de donnÃ©es
    â””â”€â”€ types/            # Types TypeScript liÃ©s Ã  ce module
```

### RÃ¨gles :

* `containers/` peut appeler les services de son propre module
* `components/` ne doit JAMAIS appeler une API ou un service
* Le `Container.tsx` fait le lien entre la page et le composant visuel

### Exemple pour `auth` :

```bash
modules/
â””â”€â”€ auth/
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ LoginForm.tsx
    â”œâ”€â”€ containers/
    â”‚   â””â”€â”€ LoginContainer.tsx
    â”œâ”€â”€ services/
    â”‚   â””â”€â”€ login.service.ts
    â””â”€â”€ types/
        â””â”€â”€ auth.types.ts
```

---

## ğŸ“ `shared/` â€” CODE GLOBAL PARTAGÃ‰

> Contient tout ce qui est rÃ©utilisable par **nâ€™importe quel module**.

### Sous-dossiers :

| Dossier       | Contenu attendu                                         |
| ------------- | ------------------------------------------------------- |
| `components/` | Composants UI partagÃ©s (ex: `Button`, `Modal`, `Input`) |
| `constants/`  | Constantes globales (ex: rÃ´les, URLs, configs)          |
| `helpers/`    | Fonctions utilitaires (ex: formatage de date)           |
| `styles/`     | Styles globaux, Tailwind config, CSS modules            |
| `fonts/`      | Importation et dÃ©finition des polices                   |
| `types/`      | Types globaux (ex: `ApiResponse`, `WithId`)             |

### Exemple :

```bash
shared/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ Button.tsx
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ roles.ts
â”œâ”€â”€ helpers/
â”‚   â””â”€â”€ formatDate.ts
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ fonts/
â”‚   â””â”€â”€ inter.ts
â””â”€â”€ types/
    â””â”€â”€ global.types.ts
```

---

## ğŸ“ `lib/` â€” OUTILS TECHNIQUES BAS NIVEAU

> Contient la logique technique rÃ©utilisable : cookies, session, cache, fetcher, middlewares.

### Exemples de fichiers :

* `auth.ts` : extraction du token utilisateur
* `cookies.ts` : manipulation cookies
* `fetcher.ts` : client fetch standardisÃ©
* `cache.ts` : utils pour le caching
* `middleware.ts` : middlewares pour auth ou logging

---

## ğŸ”„ FLUX STANDARD : ROUTE â†’ CONTAINER â†’ COMPONENT â†’ SERVICE

### Exemple de flow (login) :

```tsx
// app/(auth)/login/page.tsx
export default function LoginPage() {
  return <LoginContainer />
}

// modules/auth/containers/LoginContainer.tsx
export default async function LoginContainer() {
  const user = await loginService()
  return <LoginForm user={user} />
}

// modules/auth/components/LoginForm.tsx
export default function LoginForm({ user }: { user: User }) {
  return <div>Hello {user.name}</div>
}
```

---

## âœ… INTERDICTIONS ABSOLUES

* âŒ Appeler une API directement depuis un composant UI (`components/`)
* âŒ Importer un composant dâ€™un module dans un autre module (hors `shared`)
* âŒ Mettre de la logique mÃ©tier dans `shared/components/`

---

## âœ… BONNES PRATIQUES OBLIGATOIRES

* âœ… Centraliser tous les appels API dans les `services/`
* âœ… Utiliser `types/` dans chaque module pour garder les types isolÃ©s
* âœ… PrÃ©fÃ©rer les Server Components (`async`) dans `containers/` et `pages/`
* âœ… Ne rien dupliquer entre modules â†’ placer dans `shared/` si besoin
* âœ… Organiser les modules mÃ©tiers en silo avec sÃ©paration stricte des responsabilitÃ©s



